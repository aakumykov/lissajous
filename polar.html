<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<title>полярные координаты</title>
		<meta http-equiv="content-type" content="text/html;charset=utf-8" />
		<style>* { margin:0px; padding:0px; }
			BODY { overflow:hidden; }
		</style>
		<script>
			var config = new Object;
			
			function initApp(params) {
				createDebugPanel();
				
				var appId = Math.ceil(Math.random()*1000000000);
				params['appId'] = appId;
				initConfig(params);
				
				return appId;
			}
			function initConfig(params) {
				var appId = params['appId'];
				config[appId] = {};
				
				config.debug = params['debug'];
				
				config[appId].x0 = params['centerX'];
				config[appId].y0 = params['centerY'];
				config[appId].pointWidth = config[appId].pointHeight = 10;
				
				config[appId].radius = params['radius']
				debug('радиус: '+config[appId].radius+' точек');
				
				config[appId].perimeter = Math.round(2*config[appId].radius*Math.PI);
				debug('периметр: '+config[appId].perimeter+' точек');
				
				config[appId].pointSize = params['pointSize'];
				debug('размер точки: '+config[appId].pointSize);
				
				config[appId].pointsPerCircle = Math.round(config[appId].perimeter / config[appId].pointSize);
				debug('точек на круг: '+config[appId].pointsPerCircle);
				
				config[appId].roundsPerSecond = params['roundsPerSecond']
				debug('оборотов в секунду: '+config[appId].roundsPerSecond);
				
				config[appId].roundPeriod = Math.round(1000/config[appId].roundsPerSecond);
				debug('период кргуа: '+config[appId].roundPeriod);
				
				config[appId].pointDelay = config[appId].roundPeriod/config[appId].pointsPerCircle;
				if (config[appId].pointDelay < 1) config[appId].pointDelay=1;
				debug('задержка точки: '+config[appId].pointDelay+' мс');
				
				config[appId].arcLen = Number(params['arcLen'].replace(/%/,''));
				debug('длина дуги: '+config[appId].arcLen+'%');
				
				// процент от периода оборота
				config[appId].pointLifeTime = (1000/config[appId].roundsPerSecond) * (config[appId].arcLen/100);
				if (config[appId].pointLifeTime < 1) config[appId].pointLifeTime=1;
				debug('время жизни точки: '+config[appId].pointLifeTime+' мс');

				config[appId].angle = 0;
				
				config[appId].angleStep = 2*Math.PI / config[appId].pointsPerCircle;
				debug('шаг угла: '+config[appId].angleStep*180/Math.PI+' градусов');
				
				config.run = params['run'];
			}
			
			function start(appId) {
				//alert('start('+appId+')');
				tick(appId);
				config[appId].intervalHandler = window.setInterval("tick('"+appId+"')",config[appId].pointDelay);
			}
			function tick(appId) {
				//alert('tick('+appId+')');
				if (config.run) {
					calcXY(appId);
					createPoint(appId);
					increaseAngle(appId);
				}
			}
			function calcXY(appId) {
				config[appId].x = config[appId].radius * Math.cos(config[appId].angle);
				config[appId].y = config[appId].radius * Math.sin(config[appId].angle);
				//alert('calcXY(), x='+config[appId].x+', y='+config[appId].y);
			}
			function increaseAngle(appId) {
				config[appId].angle += config[appId].angleStep;
				if (config[appId].angle > 2*Math.PI) config[appId].angle = 0;
			}
			
			function createDebugPanel(id='debugPanel') {
				var panel = document.createElement('div')
					panel.style.position = 'absolute'
					panel.style.right = '0.5%'
					panel.style.top = '1%'
					panel.style.width = '48%'
					panel.style.height = '98%'
					panel.style.backgroundColor = 'rgb(231,231,231)'
					panel.style.overflow = 'auto'
					panel.id = id
				document.getElementById('body').appendChild(panel)
				return panel
			}
			function createPoint(appId){
				//alert('createPoint('+appId+')');
				var point = document.createElement('div');
					point.style.width = config[appId].pointSize+'px';
					point.style.height = config[appId].pointSize+'px';
					point.style.position = 'absolute';
					point.style.backgroundColor = 'deepskyblue';
					point.style.borderRadius = config[appId].pointSize+'px';
					point.style.boxShadow = '1px 1px 2px rgba(128,128,128,0.4)';
				
				var realX = (config[appId].x0 + config[appId].x - config[appId].pointSize/2);
				var realY = (config[appId].y0 + config[appId].y - config[appId].pointSize/2);
				//alert('realX='+realX+', realY='+realY);
					point.style.left = realX + 'px';
					point.style.top = realY + 'px';
				
				var id = appId+'_point_'+String(realX)+'_'+String(realY);
				point.id = id;
				window.setTimeout("removePoint('"+id+"')",config[appId].pointLifeTime);
				document.body.appendChild(point);
			}
			function removePoint(id) {
				var point = document.getElementById(id);
				point.parentNode.removeChild(point);
			}
			
			function debug(data) {
				if (config.debug) {
					var p = document.createElement('p')
						p.style.paddingLeft = '3px'
						p.style.fontSize = '11px'
						p.style.fontFamily = 'monospace'
						p.innerHTML = data
					var panel = document.getElementById('debugPanel')
						panel.appendChild(p)
				}
			}
		</script>
	</head>
	<body id='body'>
		<button onClick="config.run=!config.run">Старт/Стоп</button>
		<script>
			appId = initApp({
				centerX:400,
				centerY:300,
				radius:200,
				pointSize:10,
				roundsPerSecond:1,
				arcLen:'50%', //процентов
				run:true,
				debug:true,
			});
			//tick();
			start(appId);
		</script>
	</body>
</html>
