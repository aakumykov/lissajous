<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<title>полярные координаты</title>
		<meta http-equiv="content-type" content="text/html;charset=utf-8" />
		<style>* { margin:0px; padding:0px; }
			BODY { overflow:hidden; }
		</style>
		<script>
			var config = new Object;
			
			function initApp(params) {
				createDebugPanel();
				initConfig(params);
			}
			function initConfig(params) {
				config.x0 = params['centerX'];
				config.y0 = params['centerY'];
				config.pointWidth = config.pointHeight = 10;
				
				config.radius = params['radius']
				debug('радиус: '+config.radius+' точек');
				
				config.perimeter = Math.round(2*config.radius*Math.PI);
				debug('периметр: '+config.perimeter+' точек');
				
				config.pointSize = params['pointSize'];
				debug('размер точки: '+config.pointSize);
				
				config.pointsPerCircle = Math.round(config.perimeter / config.pointSize);
				debug('точек на круг: '+config.pointsPerCircle);
				
				config.roundsPerSecond = params['roundsPerSecond']
				debug('оборотов в секунду: '+config.roundsPerSecond);
				
				config.roundPeriod = Math.round(1000/config.roundsPerSecond);
				debug('период кргуа: '+config.roundPeriod);
				
				config.pointDelay = config.roundPeriod/config.pointsPerCircle;
				if (config.pointDelay < 1) config.pointDelay=1;
				debug('задержка точки: '+config.pointDelay+' мс');
				
				config.arcLen = Number(params['arcLen'].replace(/%/,''));
				debug('длина дуги: '+config.arcLen+'%');
				
				// процент от периода оборота
				config.pointLifeTime = (1000/config.roundsPerSecond) * (config.arcLen/100);
				if (config.pointLifeTime < 1) config.pointLifeTime=1;
				debug('время жизни точки: '+config.pointLifeTime+' мс');
				
				config.angleStep = 2*Math.PI / config.pointsPerCircle;
				debug('шаг угла: '+config.angleStep*180/Math.PI+' градусов');
				
				config.angle = 0;
				config.run = params['run'];
			}
			
			function start() {
				tick();
				config.intervalHandler = window.setInterval('tick()',config.pointDelay);
			}
			function tick() {
				if (config.run) {
					calcXY();
					createPoint();
					increaseAngle();
				}
			}
			function calcXY() {
				config.x = config.radius * Math.cos(config.angle);
				config.y = config.radius * Math.sin(config.angle);
				//alert('calcXY(), x='+config.x+', y='+config.y);
			}
			function increaseAngle() {
				config.angle += config.angleStep;
				if (config.angle > 2*Math.PI) config.angle = 0;
			}
			
			function createDebugPanel(id='debugPanel') {
				var panel = document.createElement('div')
					panel.style.position = 'absolute'
					panel.style.right = '0.5%'
					panel.style.top = '1%'
					panel.style.width = '48%'
					panel.style.height = '98%'
					panel.style.backgroundColor = 'rgb(231,231,231)'
					panel.style.overflow = 'auto'
					panel.id = id
				document.getElementById('body').appendChild(panel)
				return panel
			}
			function createPoint(){
				var point = document.createElement('div');
					point.style.width = config.pointSize+'px';
					point.style.height = config.pointSize+'px';
					point.style.position = 'absolute';
					point.style.backgroundColor = 'deepskyblue';
					point.style.borderRadius = config.pointSize+'px';
					point.style.boxShadow = '1px 1px 2px rgba(128,128,128,0.4)';
				
				var realX = (config.x0 + config.x - config.pointSize/2);
				var realY = (config.y0 + config.y - config.pointSize/2);
				//alert('realX='+realX+', realY='+realY);
					point.style.left = realX + 'px';
					point.style.top = realY + 'px';
				
				var id = 'point_'+String(realX)+'_'+String(realY);
				point.id = id;
				window.setTimeout("removePoint('"+id+"')",config.pointLifeTime);
				document.body.appendChild(point);
			}
			function removePoint(id) {
				var point = document.getElementById(id);
				point.parentNode.removeChild(point);
			}
			
			function debug(data) {
				var p = document.createElement('p')
					p.style.paddingLeft = '3px'
					p.style.fontSize = '11px'
					p.style.fontFamily = 'monospace'
					p.innerHTML = data
				var panel = document.getElementById('debugPanel')
					panel.appendChild(p)
			}
		</script>
	</head>
	<body id='body'>
		<button onClick="config.run=!config.run">Старт/Стоп</button>
		<script>
			initApp({
				centerX:400,
				centerY:300,
				radius:200,
				pointSize:10,
				roundsPerSecond:1,
				arcLen:'50%', //процентов
				run:true,
			});
			//tick();
			start();
		</script>
	</body>
</html>
